(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function e0(e,r,n){const t=e.getContext("webgpu");return t.configure({device:r,format:n,alphaMode:"opaque"}),t}function r0(e,r,n,t){const s=e.createCommandEncoder(),i={colorAttachments:[],depthStencilAttachment:{view:t.shadowDepthView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}};E(s,i,[t.shadowBindGroup],t,n.shadowPass);const o={colorAttachments:[{view:r,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:t.renderDepthView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}};E(s,o,t.bindGroups,t,n.mainPass),e.queue.submit([s.finish()])}function E(e,r,n,t,s){const i=t.spheres.indexedBuffer,o=t.cubes.indexedBuffer,a=e.beginRenderPass(r);a.setPipeline(s),n.forEach((u,h)=>a.setBindGroup(h,u)),a.setVertexBuffer(0,i.vertex),a.setIndexBuffer(i.index,"uint16"),a.drawIndexed(i.indexCount,t.spheres.numberOfInstances),a.setVertexBuffer(0,o.vertex),a.setIndexBuffer(o.index,"uint16"),a.drawIndexed(o.indexCount,t.cubes.numberOfInstances,void 0,void 0,t.spheres.numberOfInstances),a.end()}function n0(e,r,n,t,s){const i=e0(n,e,t);return o=>{s.update(o),r0(e,i.getCurrentTexture().createView(),r,s)}}function t0(){let e=0;const r=[],n=new Map,t=()=>{for(;r.length;)n.delete(r.pop());n.forEach(i=>{i(Date.now())}),requestAnimationFrame(t)};return requestAnimationFrame(t),i=>{const o=e++;return n.set(o,i),()=>{r.push(o)}}}async function s0(){var r;const e=await((r=navigator.gpu)==null?void 0:r.requestAdapter());return await(e==null?void 0:e.requestDevice())}const F=`@group(0) @binding(0) var<storage> modelViews : array<mat4x4<f32>>;\r
@group(0) @binding(1) var<uniform> cameraProjection : mat4x4<f32>;\r
@group(0) @binding(2) var<uniform> lightProjection : mat4x4<f32>;\r
@group(0) @binding(3) var<storage> colors : array<vec4<f32>>;\r
\r
struct VertexOutput {\r
    @builtin(position) Position: vec4<f32>,\r
    @location(0) fragPosition: vec3<f32>,\r
    @location(1) fragNormal: vec3<f32>,\r
    @location(2) fragUV: vec2<f32>,\r
    @location(3) shadowPos: vec3<f32>,\r
    @location(4) fragColor: vec4<f32>\r
};\r
\r
@vertex\r
fn main(\r
    @builtin(instance_index) index: u32,\r
    @location(0) position: vec3<f32>,\r
    @location(1) normal: vec3<f32>,\r
    @location(2) uv: vec2<f32>\r
) -> VertexOutput {\r
    let modelview = modelViews[index];\r
    let pos = vec4<f32>(position, 1.0);\r
    let posFromCamera: vec4<f32> = cameraProjection * modelview * pos;\r
\r
    var output: VertexOutput;\r
    output.Position = posFromCamera;\r
    output.fragPosition = (modelview * pos).xyz;\r
    output.fragNormal = (modelview * vec4<f32>(normal, 0.0)).xyz;\r
    output.fragUV = uv;\r
    output.fragColor = colors[index];\r
\r
    let posFromLight: vec4<f32> = lightProjection * modelview * pos;\r
    // Convert shadowPos XY to (0, 1) to fit texture UV\r
    output.shadowPos = vec3<f32>(posFromLight.xy * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5, 0.5), posFromLight.z);\r
    return output;\r
}\r
\r
@group(1) @binding(0) var<uniform> lightPosition : vec4<f32>;\r
@group(1) @binding(1) var shadowMap: texture_depth_2d;\r
@group(1) @binding(2) var shadowSampler: sampler_comparison;\r
\r
@fragment\r
fn fs_main(\r
    @location(0) fragPosition: vec3<f32>,\r
    @location(1) fragNormal: vec3<f32>,\r
    @location(2) fragUV: vec2<f32>,\r
    @location(3) shadowPos: vec3<f32>,\r
    @location(4) fragColor: vec4<f32>\r
) -> @location(0) vec4<f32> {\r
    let objectColor = fragColor.rgb;\r
\r
    let diffuse: f32 = max(dot(normalize(lightPosition.xyz), fragNormal), 0.0);\r
\r
    var shadow: f32 = 0.0;\r
\r
    let size = f32(textureDimensions(shadowMap).x);\r
    for (var y: i32 = -1 ; y <= 1 ; y = y + 1) {\r
        for (var x: i32 = -1 ; x <= 1 ; x = x + 1) {\r
            let offset = vec2<f32>(f32(x) / size, f32(y) / size);\r
            shadow = shadow + textureSampleCompare(\r
                shadowMap,\r
                shadowSampler,\r
                shadowPos.xy + offset,\r
                shadowPos.z - 0.005\r
            );\r
        }\r
    }\r
    shadow = shadow / 9.0;\r
\r
    let lightFactor = min(0.5 + shadow * diffuse, 1.0);\r
    return vec4<f32>(objectColor * lightFactor, 1.0);\r
}\r
`,i0=`@group(0) @binding(0) var<storage> modelViews : array<mat4x4<f32>>;\r
@group(0) @binding(1) var<uniform> lightProjection : mat4x4<f32>;\r
\r
@vertex\r
fn main(\r
    @builtin(instance_index) index: u32,\r
    @location(0) position: vec3<f32>,\r
    @location(1) normal: vec3<f32>,\r
    @location(2) uv: vec2<f32>,\r
) -> @builtin(position) vec4<f32> {\r
    let modelview = modelViews[index];\r
    let pos = vec4(position, 1.0);\r
    return lightProjection * modelview * pos;\r
}\r
`,q=[{arrayStride:8*4,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:3*4,format:"float32x3"},{shaderLocation:2,offset:5*4,format:"float32x2"}]}],R={topology:"triangle-list",cullMode:"back"},Y={depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"};async function o0(e,r){const n={label:"Shadow Pipline",layout:"auto",vertex:{module:e.createShaderModule({code:i0}),entryPoint:"main",buffers:q},primitive:R,depthStencil:Y};return await e.createRenderPipelineAsync(n)}async function a0(e,r){const n={layout:"auto",vertex:{module:e.createShaderModule({code:F}),entryPoint:"main",buffers:q},primitive:R,depthStencil:Y,fragment:{module:e.createShaderModule({code:F}),entryPoint:"fs_main",targets:[{format:r}]}};return await e.createRenderPipelineAsync(n)}var z=1e-6,S=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function M(){var e=new S(16);return S!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function c0(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function X(e,r,n){var t=r[0],s=r[1],i=r[2],o=r[3],a=r[4],u=r[5],h=r[6],c=r[7],f=r[8],l=r[9],p=r[10],d=r[11],y=r[12],b=r[13],P=r[14],B=r[15],g=n[0],m=n[1],v=n[2],x=n[3];return e[0]=g*t+m*a+v*f+x*y,e[1]=g*s+m*u+v*l+x*b,e[2]=g*i+m*h+v*p+x*P,e[3]=g*o+m*c+v*d+x*B,g=n[4],m=n[5],v=n[6],x=n[7],e[4]=g*t+m*a+v*f+x*y,e[5]=g*s+m*u+v*l+x*b,e[6]=g*i+m*h+v*p+x*P,e[7]=g*o+m*c+v*d+x*B,g=n[8],m=n[9],v=n[10],x=n[11],e[8]=g*t+m*a+v*f+x*y,e[9]=g*s+m*u+v*l+x*b,e[10]=g*i+m*h+v*p+x*P,e[11]=g*o+m*c+v*d+x*B,g=n[12],m=n[13],v=n[14],x=n[15],e[12]=g*t+m*a+v*f+x*y,e[13]=g*s+m*u+v*l+x*b,e[14]=g*i+m*h+v*p+x*P,e[15]=g*o+m*c+v*d+x*B,e}function T(e,r,n){var t=n[0],s=n[1],i=n[2],o,a,u,h,c,f,l,p,d,y,b,P;return r===e?(e[12]=r[0]*t+r[4]*s+r[8]*i+r[12],e[13]=r[1]*t+r[5]*s+r[9]*i+r[13],e[14]=r[2]*t+r[6]*s+r[10]*i+r[14],e[15]=r[3]*t+r[7]*s+r[11]*i+r[15]):(o=r[0],a=r[1],u=r[2],h=r[3],c=r[4],f=r[5],l=r[6],p=r[7],d=r[8],y=r[9],b=r[10],P=r[11],e[0]=o,e[1]=a,e[2]=u,e[3]=h,e[4]=c,e[5]=f,e[6]=l,e[7]=p,e[8]=d,e[9]=y,e[10]=b,e[11]=P,e[12]=o*t+c*s+d*i+r[12],e[13]=a*t+f*s+y*i+r[13],e[14]=u*t+l*s+b*i+r[14],e[15]=h*t+p*s+P*i+r[15]),e}function I(e,r,n){var t=n[0],s=n[1],i=n[2];return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=r[7]*s,e[8]=r[8]*i,e[9]=r[9]*i,e[10]=r[10]*i,e[11]=r[11]*i,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function L(e,r,n){var t=Math.sin(n),s=Math.cos(n),i=r[4],o=r[5],a=r[6],u=r[7],h=r[8],c=r[9],f=r[10],l=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=i*s+h*t,e[5]=o*s+c*t,e[6]=a*s+f*t,e[7]=u*s+l*t,e[8]=h*s-i*t,e[9]=c*s-o*t,e[10]=f*s-a*t,e[11]=l*s-u*t,e}function N(e,r,n){var t=Math.sin(n),s=Math.cos(n),i=r[0],o=r[1],a=r[2],u=r[3],h=r[8],c=r[9],f=r[10],l=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*s-h*t,e[1]=o*s-c*t,e[2]=a*s-f*t,e[3]=u*s-l*t,e[8]=i*t+h*s,e[9]=o*t+c*s,e[10]=a*t+f*s,e[11]=u*t+l*s,e}function j(e,r,n){var t=Math.sin(n),s=Math.cos(n),i=r[0],o=r[1],a=r[2],u=r[3],h=r[4],c=r[5],f=r[6],l=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*s+h*t,e[1]=o*s+c*t,e[2]=a*s+f*t,e[3]=u*s+l*t,e[4]=h*s-i*t,e[5]=c*s-o*t,e[6]=f*s-a*t,e[7]=l*s-u*t,e}function f0(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=t,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l0(e,r,n,t,s){var i=1/Math.tan(r/2),o;return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(t-s),e[10]=(s+t)*o,e[14]=2*s*t*o):(e[10]=-1,e[14]=-2*t),e}var u0=l0;function h0(e,r,n,t,s,i,o){var a=1/(r-n),u=1/(t-s),h=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(r+n)*a,e[13]=(s+t)*u,e[14]=(o+i)*h,e[15]=1,e}var p0=h0;function $(e,r,n,t){var s,i,o,a,u,h,c,f,l,p,d=r[0],y=r[1],b=r[2],P=t[0],B=t[1],g=t[2],m=n[0],v=n[1],x=n[2];return Math.abs(d-m)<z&&Math.abs(y-v)<z&&Math.abs(b-x)<z?c0(e):(c=d-m,f=y-v,l=b-x,p=1/Math.hypot(c,f,l),c*=p,f*=p,l*=p,s=B*l-g*f,i=g*c-P*l,o=P*f-B*c,p=Math.hypot(s,i,o),p?(p=1/p,s*=p,i*=p,o*=p):(s=0,i=0,o=0),a=f*o-l*i,u=l*s-c*o,h=c*i-f*s,p=Math.hypot(a,u,h),p?(p=1/p,a*=p,u*=p,h*=p):(a=0,u=0,h=0),e[0]=s,e[1]=a,e[2]=c,e[3]=0,e[4]=i,e[5]=u,e[6]=f,e[7]=0,e[8]=o,e[9]=h,e[10]=l,e[11]=0,e[12]=-(s*d+i*y+o*b),e[13]=-(a*d+u*y+h*b),e[14]=-(c*d+f*y+l*b),e[15]=1,e)}function d0(){var e=new S(3);return S!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function w(e,r,n){var t=new S(3);return t[0]=e,t[1]=r,t[2]=n,t}function g0(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e}function v0(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e}function m0(e,r,n){var t=r[0],s=r[1],i=r[2],o=n[3]*t+n[7]*s+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*t+n[4]*s+n[8]*i+n[12])/o,e[1]=(n[1]*t+n[5]*s+n[9]*i+n[13])/o,e[2]=(n[2]*t+n[6]*s+n[10]*i+n[14])/o,e}(function(){var e=d0();return function(r,n,t,s,i,o){var a,u;for(n||(n=3),t||(t=0),s?u=Math.min(s*n+t,r.length):u=r.length,a=t;a<u;a+=n)e[0]=r[a],e[1]=r[a+1],e[2]=r[a+2],i(e,e,o),r[a]=e[0],r[a+1]=e[1],r[a+2]=e[2];return r}})();const x0=new Float32Array([.5,.5,.5,1,0,0,0,1,.5,.5,-.5,1,0,0,1,1,.5,-.5,.5,1,0,0,0,0,.5,-.5,-.5,1,0,0,1,0,-.5,.5,-.5,-1,0,0,0,1,-.5,.5,.5,-1,0,0,1,1,-.5,-.5,-.5,-1,0,0,0,0,-.5,-.5,.5,-1,0,0,1,0,-.5,.5,-.5,0,1,0,0,1,.5,.5,-.5,0,1,0,1,1,-.5,.5,.5,0,1,0,0,0,.5,.5,.5,0,1,0,1,0,-.5,-.5,.5,0,-1,0,0,1,.5,-.5,.5,0,-1,0,1,1,-.5,-.5,-.5,0,-1,0,0,0,.5,-.5,-.5,0,-1,0,1,0,-.5,.5,.5,0,0,1,0,1,.5,.5,.5,0,0,1,1,1,-.5,-.5,.5,0,0,1,0,0,.5,-.5,.5,0,0,1,1,0,.5,.5,-.5,0,0,-1,0,1,-.5,.5,-.5,0,0,-1,1,1,.5,-.5,-.5,0,0,-1,0,0,-.5,-.5,-.5,0,0,-1,1,0]),w0=new Uint16Array([0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21]),y0=24,b0=36,P0={vertex:x0,index:w0,vertexCount:y0,indexCount:b0},B0=new Float32Array([0,1,0,0,1,0,.05,1,0,1,0,0,1,0,.15,1,0,1,0,0,1,0,.25,1,0,1,0,0,1,0,.35,1,0,1,0,0,1,0,.45,1,0,1,0,0,1,0,.55,1,0,1,0,0,1,0,.65,1,0,1,0,0,1,0,.75,1,0,1,0,0,1,0,.85,1,0,1,0,0,1,0,.95,1,0,1,0,0,1,0,1.05,1,-.30902,.95106,0,-.30902,.95106,0,0,.9,-.25,.95106,.18164,-.25,.95106,.18164,.1,.9,-.09549,.95106,.29389,-.09549,.95106,.29389,.2,.9,.09549,.95106,.29389,.09549,.95106,.29389,.3,.9,.25,.95106,.18164,.25,.95106,.18164,.4,.9,.30902,.95106,0,.30902,.95106,0,.5,.9,.25,.95106,-.18164,.25,.95106,-.18164,.6,.9,.09549,.95106,-.29389,.09549,.95106,-.29389,.7,.9,-.09549,.95106,-.29389,-.09549,.95106,-.29389,.8,.9,-.25,.95106,-.18164,-.25,.95106,-.18164,.9,.9,-.30902,.95106,0,-.30902,.95106,0,1,.9,-.58779,.80902,0,-.58779,.80902,0,0,.8,-.47553,.80902,.34549,-.47553,.80902,.34549,.1,.8,-.18164,.80902,.55902,-.18164,.80902,.55902,.2,.8,.18164,.80902,.55902,.18164,.80902,.55902,.3,.8,.47553,.80902,.34549,.47553,.80902,.34549,.4,.8,.58779,.80902,0,.58779,.80902,0,.5,.8,.47553,.80902,-.34549,.47553,.80902,-.34549,.6,.8,.18164,.80902,-.55902,.18164,.80902,-.55902,.7,.8,-.18164,.80902,-.55902,-.18164,.80902,-.55902,.8,.8,-.47553,.80902,-.34549,-.47553,.80902,-.34549,.9,.8,-.58779,.80902,0,-.58779,.80902,0,1,.8,-.80902,.58779,0,-.80902,.58779,0,0,.7,-.65451,.58779,.47553,-.65451,.58779,.47553,.1,.7,-.25,.58779,.76942,-.25,.58779,.76942,.2,.7,.25,.58779,.76942,.25,.58779,.76942,.3,.7,.65451,.58779,.47553,.65451,.58779,.47553,.4,.7,.80902,.58779,0,.80902,.58779,0,.5,.7,.65451,.58779,-.47553,.65451,.58779,-.47553,.6,.7,.25,.58779,-.76942,.25,.58779,-.76942,.7,.7,-.25,.58779,-.76942,-.25,.58779,-.76942,.8,.7,-.65451,.58779,-.47553,-.65451,.58779,-.47553,.9,.7,-.80902,.58779,0,-.80902,.58779,0,1,.7,-.95106,.30902,0,-.95106,.30902,0,0,.6,-.76942,.30902,.55902,-.76942,.30902,.55902,.1,.6,-.29389,.30902,.90451,-.29389,.30902,.90451,.2,.6,.29389,.30902,.90451,.29389,.30902,.90451,.3,.6,.76942,.30902,.55902,.76942,.30902,.55902,.4,.6,.95106,.30902,0,.95106,.30902,0,.5,.6,.76942,.30902,-.55902,.76942,.30902,-.55902,.6,.6,.29389,.30902,-.90451,.29389,.30902,-.90451,.7,.6,-.29389,.30902,-.90451,-.29389,.30902,-.90451,.8,.6,-.76942,.30902,-.55902,-.76942,.30902,-.55902,.9,.6,-.95106,.30902,0,-.95106,.30902,0,1,.6,-1,0,0,-1,0,0,0,.5,-.80902,0,.58779,-.80902,0,.58779,.1,.5,-.30902,0,.95106,-.30902,0,.95106,.2,.5,.30902,0,.95106,.30902,0,.95106,.3,.5,.80902,0,.58779,.80902,0,.58779,.4,.5,1,0,0,1,0,0,.5,.5,.80902,0,-.58779,.80902,0,-.58779,.6,.5,.30902,0,-.95106,.30902,0,-.95106,.7,.5,-.30902,0,-.95106,-.30902,0,-.95106,.8,.5,-.80902,0,-.58779,-.80902,0,-.58779,.9,.5,-1,0,0,-1,0,0,1,.5,-.95106,-.30902,0,-.95106,-.30902,0,0,.4,-.76942,-.30902,.55902,-.76942,-.30902,.55902,.1,.4,-.29389,-.30902,.90451,-.29389,-.30902,.90451,.2,.4,.29389,-.30902,.90451,.29389,-.30902,.90451,.3,.4,.76942,-.30902,.55902,.76942,-.30902,.55902,.4,.4,.95106,-.30902,0,.95106,-.30902,0,.5,.4,.76942,-.30902,-.55902,.76942,-.30902,-.55902,.6,.4,.29389,-.30902,-.90451,.29389,-.30902,-.90451,.7,.4,-.29389,-.30902,-.90451,-.29389,-.30902,-.90451,.8,.4,-.76942,-.30902,-.55902,-.76942,-.30902,-.55902,.9,.4,-.95106,-.30902,0,-.95106,-.30902,0,1,.4,-.80902,-.58779,0,-.80902,-.58779,0,0,.3,-.65451,-.58779,.47553,-.65451,-.58779,.47553,.1,.3,-.25,-.58779,.76942,-.25,-.58779,.76942,.2,.3,.25,-.58779,.76942,.25,-.58779,.76942,.3,.3,.65451,-.58779,.47553,.65451,-.58779,.47553,.4,.3,.80902,-.58779,0,.80902,-.58779,0,.5,.3,.65451,-.58779,-.47553,.65451,-.58779,-.47553,.6,.3,.25,-.58779,-.76942,.25,-.58779,-.76942,.7,.3,-.25,-.58779,-.76942,-.25,-.58779,-.76942,.8,.3,-.65451,-.58779,-.47553,-.65451,-.58779,-.47553,.9,.3,-.80902,-.58779,0,-.80902,-.58779,0,1,.3,-.58779,-.80902,0,-.58779,-.80902,0,0,.2,-.47553,-.80902,.34549,-.47553,-.80902,.34549,.1,.2,-.18164,-.80902,.55902,-.18164,-.80902,.55902,.2,.2,.18164,-.80902,.55902,.18164,-.80902,.55902,.3,.2,.47553,-.80902,.34549,.47553,-.80902,.34549,.4,.2,.58779,-.80902,0,.58779,-.80902,0,.5,.2,.47553,-.80902,-.34549,.47553,-.80902,-.34549,.6,.2,.18164,-.80902,-.55902,.18164,-.80902,-.55902,.7,.2,-.18164,-.80902,-.55902,-.18164,-.80902,-.55902,.8,.2,-.47553,-.80902,-.34549,-.47553,-.80902,-.34549,.9,.2,-.58779,-.80902,0,-.58779,-.80902,0,1,.2,-.30902,-.95106,0,-.30902,-.95106,0,0,.1,-.25,-.95106,.18164,-.25,-.95106,.18164,.1,.1,-.09549,-.95106,.29389,-.09549,-.95106,.29389,.2,.1,.09549,-.95106,.29389,.09549,-.95106,.29389,.3,.1,.25,-.95106,.18164,.25,-.95106,.18164,.4,.1,.30902,-.95106,0,.30902,-.95106,0,.5,.1,.25,-.95106,-.18164,.25,-.95106,-.18164,.6,.1,.09549,-.95106,-.29389,.09549,-.95106,-.29389,.7,.1,-.09549,-.95106,-.29389,-.09549,-.95106,-.29389,.8,.1,-.25,-.95106,-.18164,-.25,-.95106,-.18164,.9,.1,-.30902,-.95106,0,-.30902,-.95106,0,1,.1,0,-1,0,0,-1,0,-.05,0,0,-1,0,0,-1,0,.05,0,0,-1,0,0,-1,0,.15,0,0,-1,0,0,-1,0,.25,0,0,-1,0,0,-1,0,.35,0,0,-1,0,0,-1,0,.45,0,0,-1,0,0,-1,0,.55,0,0,-1,0,0,-1,0,.65,0,0,-1,0,0,-1,0,.75,0,0,-1,0,0,-1,0,.85,0,0,-1,0,0,-1,0,.95,0]),U0=new Uint16Array([0,11,12,1,12,13,2,13,14,3,14,15,4,15,16,5,16,17,6,17,18,7,18,19,8,19,20,9,20,21,12,11,23,11,22,23,13,12,24,12,23,24,14,13,25,13,24,25,15,14,26,14,25,26,16,15,27,15,26,27,17,16,28,16,27,28,18,17,29,17,28,29,19,18,30,18,29,30,20,19,31,19,30,31,21,20,32,20,31,32,23,22,34,22,33,34,24,23,35,23,34,35,25,24,36,24,35,36,26,25,37,25,36,37,27,26,38,26,37,38,28,27,39,27,38,39,29,28,40,28,39,40,30,29,41,29,40,41,31,30,42,30,41,42,32,31,43,31,42,43,34,33,45,33,44,45,35,34,46,34,45,46,36,35,47,35,46,47,37,36,48,36,47,48,38,37,49,37,48,49,39,38,50,38,49,50,40,39,51,39,50,51,41,40,52,40,51,52,42,41,53,41,52,53,43,42,54,42,53,54,45,44,56,44,55,56,46,45,57,45,56,57,47,46,58,46,57,58,48,47,59,47,58,59,49,48,60,48,59,60,50,49,61,49,60,61,51,50,62,50,61,62,52,51,63,51,62,63,53,52,64,52,63,64,54,53,65,53,64,65,56,55,67,55,66,67,57,56,68,56,67,68,58,57,69,57,68,69,59,58,70,58,69,70,60,59,71,59,70,71,61,60,72,60,71,72,62,61,73,61,72,73,63,62,74,62,73,74,64,63,75,63,74,75,65,64,76,64,75,76,67,66,78,66,77,78,68,67,79,67,78,79,69,68,80,68,79,80,70,69,81,69,80,81,71,70,82,70,81,82,72,71,83,71,82,83,73,72,84,72,83,84,74,73,85,73,84,85,75,74,86,74,85,86,76,75,87,75,86,87,78,77,89,77,88,89,79,78,90,78,89,90,80,79,91,79,90,91,81,80,92,80,91,92,82,81,93,81,92,93,83,82,94,82,93,94,84,83,95,83,94,95,85,84,96,84,95,96,86,85,97,85,96,97,87,86,98,86,97,98,89,88,100,88,99,100,90,89,101,89,100,101,91,90,102,90,101,102,92,91,103,91,102,103,93,92,104,92,103,104,94,93,105,93,104,105,95,94,106,94,105,106,96,95,107,95,106,107,97,96,108,96,107,108,98,97,109,97,108,109,100,99,111,101,100,112,102,101,113,103,102,114,104,103,115,105,104,116,106,105,117,107,106,118,108,107,119,109,108,120]),M0=121,O0=540,C0={vertex:B0,index:U0,vertexCount:M0,indexCount:O0},S0=w(0,1,0);function G0(e,r=60/180*Math.PI,n=.1,t=100,s=w(0,0,0),i=w(0,0,0)){const o=M();T(o,o,s),$(o,s,i,S0);const a=M();return u0(a,r,e,n,t),X(a,a,o),a}var _=function(e,r){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])},_(e,r)};function V(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}_(e,r),e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}var A,D=function(){function e(){}return e._xfnv1a=function(r){for(var n=2166136261,t=0;t<r.length;t++)n=Math.imul(n^r.charCodeAt(t),16777619);return function(){return n+=n<<13,n^=n>>>7,n+=n<<3,n^=n>>>17,(n+=n<<5)>>>0}},e}(),z0=function(e){function r(n){var t=e.call(this)||this;return t.a=r._xfnv1a(n)(),t}return V(r,e),r.prototype.next=function(){var n=this.a+=1831565813;return n=Math.imul(n^n>>>15,1|n),(((n^=n+Math.imul(n^n>>>7,61|n))^n>>>14)>>>0)/4294967296},r}(D),T0=function(e){function r(n){var t=e.call(this)||this,s=r._xfnv1a(n);return t.a=s(),t.b=s(),t.c=s(),t.d=s(),t}return V(r,e),r.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var n=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,n=n+this.d|0,this.c=this.c+n|0,(n>>>0)/4294967296},r}(D),_0=function(e){function r(n){var t=e.call(this)||this,s=r._xfnv1a(n);return t.a=s(),t.b=s(),t.c=s(),t.d=s(),t}return V(r,e),r.prototype.next=function(){var n=this.b<<9,t=5*this.a;return t=t<<7|9*(t>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=n,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},r}(D);(function(e){e.sfc32="sfc32",e.mulberry32="mulberry32",e.xoshiro128ss="xoshiro128ss"})(A||(A={}));var A0=function(){function e(r,n){n===void 0&&(n=A.sfc32),this.str=r,this.prng=n,this.generator=this._initializeGenerator()}return e.prototype.next=function(){return this.generator.next()},e.prototype._initializeGenerator=function(){if(function(n){return n===null}(r=this.str)||function(n){return n===void 0}(r))return this.wrap();var r;switch(this.prng){case"sfc32":return new T0(this.str);case"mulberry32":return new z0(this.str);case"xoshiro128ss":return new _0(this.str);default:return this.wrap()}},e.prototype.wrap=function(){return{next:function(){return Math.random()}}},e}();const O=w(0,10,-40),H=-5,V0="aa",G=new A0(V0),C=e=>(G.next()-.5)*e;function D0(e,r){const n=C0,t=[],s=[];for(let u=0;u<r;u++){const h=w(O[0]+C(30),O[1]+C(5),O[2]+C(30)),c=Math.abs(h[0])+Math.abs(h[2]),f=w(0,0,-2),l=.5+(G.next()-.5)*.2;t.push({position:h,rotation:f,scale:w(l,l,l)}),s.push(c*(G.next()+.5))}const i=e.createBuffer({size:n.vertex.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),o=e.createBuffer({size:n.index.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(i,0,n.vertex),e.queue.writeBuffer(o,0,n.index);const a={...n,vertex:i,index:o};return{transforms:t,numberOfInstances:r,speeds:s,indexedBuffer:a}}function E0(){return{position:w(0,H,-100),rotation:w(0,0,0),scale:w(200,.1,200)}}function F0(e,r){const n=P0,t=[E0()];for(let a=1;a<r;a++){const u=w(O[0]+C(60),H,O[2]+C(60)),h=w(0,0,0),c=1.5+(G.next()-.5)*.2,f=3+G.next()*3;t.push({position:u,rotation:h,scale:w(c,f,c)})}const s=e.createBuffer({size:n.vertex.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),i=e.createBuffer({size:n.index.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(s,0,n.vertex),e.queue.writeBuffer(i,0,n.index);const o={...n,vertex:s,index:i};return{transforms:t,numberOfInstances:r,indexedBuffer:o}}function I0(e,r,n,t,s){const a=D0(e,52),u=F0(e,15),h=[[.82,.82,.48],[.67,.45,.49],[.3,.4,.5],[.45,.29,.51],[.27,.39,.24]],c=52+15,f=new Float32Array(4*c),l=e.createBuffer({label:"colourBuffer",size:4*4*c,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});for(let U=0;U<c;U++){const Q=U%h.length;f.set(h[Q],U*4)}e.queue.writeBuffer(l,0,f);const p=e.createBuffer({label:"mvBuffer",size:4*4*4*(52+15),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),d=e.createBuffer({label:"projectionBuffer",size:4*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),y=e.createBuffer({label:"GPUBuffer for light projection",size:4*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),b=e.createBindGroup({label:"vertex bindgroup",layout:r.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:p}},{binding:1,resource:{buffer:d}},{binding:2,resource:{buffer:y}},{binding:3,resource:{buffer:l}}]}),P=e.createTexture({size:[2048,2048],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,format:"depth32float"}),B=e.createTexture({size:{width:t,height:s},format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT}),g=P.createView(),m=B.createView(),v=e.createBuffer({label:"GPUBuffer store 4x4 matrix",size:4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),x=e.createBindGroup({label:"Group for fragment",layout:r.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:v}},{binding:1,resource:g},{binding:2,resource:e.createSampler({compare:"less"})}]}),k=e.createBindGroup({label:"Group for shadowPass",layout:n.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:p}},{binding:1,resource:{buffer:y}}]}),W=t/s,K=G0(W,60/180*Math.PI,.1,1e3,w(0,40,-5),w(0,0,-30));e.queue.writeBuffer(d,0,K);const Z=L0(e,v,y),J=N0(e,u,a,p);return{spheres:a,cubes:u,bindGroups:[b,x],shadowBindGroup:k,shadowDepthView:g,renderDepthView:m,update:U=>{Z(U),J(U)}}}function L0(e,r,n){const t=M(),s=M(),i=0,o=30,a=w(i,80,o),u=w(0,1,0),h=w(0,0,-50);return c=>{const f=c/2e3;a[0]=i+Math.sin(f)*30,a[2]=o+Math.cos(f)*25,$(t,a,h,u),p0(s,-40,40,-40,40,-50,200),X(s,s,t),e.queue.writeBuffer(n,0,s),e.queue.writeBuffer(r,0,a)}}function N0(e,r,n,t){return s=>{const i=s/1e3,o=n.numberOfInstances,a=r.numberOfInstances,u=n.speeds,h=new Float32Array((o+a)*4*4);for(let c=0;c<o;c++){const f=n.transforms[c],l=M();f0(l,u[c]*(i*Math.PI*2)/1e3);let p=w(f.position[0],f.position[1],f.position[2]);v0(p,p,O),m0(p,p,l),g0(p,p,O);const d=M();T(d,d,p),L(d,d,f.rotation[0]),N(d,d,f.rotation[1]),j(d,d,f.rotation[2]),I(d,d,f.scale),h.set(d,c*4*4)}for(let c=0;c<a;c++){const f=r.transforms[c],l=M();T(l,l,f.position),I(l,l,f.scale),L(l,l,f.rotation[0]),N(l,l,f.rotation[1]),j(l,l,f.rotation[2]),h.set(l,(c+o)*4*4)}e.queue.writeBuffer(t,0,h)}}(async()=>{const e=document.querySelector("canvas");e.width=500,e.height=500;const r=await s0(),n=t0();let t;const s=async()=>{var c;t==null||t();const i=(c=navigator.gpu)==null?void 0:c.getPreferredCanvasFormat(),o=await a0(r,i),a=await o0(r),u=I0(r,o,a,e.width,e.height),h=n0(r,{mainPass:o,shadowPass:a},e,i,u);t=n(h)};navigator.gpu?s():document.getElementsByClassName("content")[0].innerHTML="Browser doesn't support Webgpu"})();
